service: la-foulee-ssr
plugins:
  - serverless-offline
  # - serverless-domain-manager

# You can pin your service to only deploy with a specific Serverless version
# Check out our docs for more details
# frameworkVersion: "=X.X.X"

package:
  individually: true
  exclude:
    - .git/**
    - .gitignore
    - pages/**
    - components/**
    - svgs/**
  # include:
  #   - node_modules/react
  #   - node_modules/react-dom
  #   - node_modules/next
  #   - node_modules/aws-api-gateway-client
  #   - .next/**

provider:
  name: aws
  runtime: nodejs6.10
  stage: dev
  # region: ue-west-1
  memorySize: 128
  environment:
    NODE_ENV: production # Next.js is running in production mode
    ASSETS_URL: ${file(./config.yml):ASSETS_URL}
    AccessKeyID: ${file(./config.yml):AccessKeyID}
    SecretAccessKey: ${file(./config.yml):SecretAccessKey}
    stageAPI: ${file(./config.yml):stageAPI}

functions:
  GetEvent:
    handler: getEvent.handler
    events:
      - http: 'GET /event/{proxy+}'
  Search:
    handler: searchEvents.handler
    events:
      - http: GET /search
  NextJSFiles:
    handler: getNextJSFiles.handler
    events:
      - http: 'GET /_next/{proxy+}'
  GetStaticFiles:
    handler: getStaticFiles.handler
    events:
      - http: 'GET /static/{proxy+}'

# custom:
#   customDomain:
#     domainName: dev.la-foulee.com
#     basePath: ''
#     stage: ${self:provider.stage}
#     createRoute53Record: true
